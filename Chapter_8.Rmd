
# The Normal Distribution

```{r}
library(IntroStats)
```

The most important distribution in statistics is the normal distribution. The formula was first published by Abraham De Moivre (1667 - 1754) on November 12, 1733. It is also called Gaussian distribution to honor Carl Friedrich Gauss (1777-1855). The density function is given by

$$
	f(x) = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{(x-\mu)^2}{2\sigma^2}}, \hspace{1in} -\infty < x < \infty.
$$
	
The probability of interest $P(a<x<b)$ can be calculated using the density function as 
$$
\int_a^b f(x)dx.
$$

Denote the cumulative distribution function $$F(x) = P(X \le x) = \int_{-\infty}^x f(u)du$$, i.e., the area under the curve from $-\infty$ to $x$. As a result, $$P(a<x<b) = F(b) - F(a)$$, which is the area under the curve from $a$ to $b$.

![Normal Density Curves](https://i.ibb.co/kyHHYFb/normal.png)

```{r}
    ################################
		#18. Normal distribution
		################################
		x = seq(-3, 5, by=0.01)
		plot(x, dnorm(x), type="l", lwd=2, ylab="", main="Normal Density Curves")
		lines(x, dnorm(x, mean=1, sd=2), col="red", lwd=2)
		lines(c(0,0),c(0,dnorm(0)), lty=2)
		lines(c(1,1),c(0,dnorm(1, mean=1, sd=2)), col="red", lty=2)
		legend("topright", legend=c("N(0, 1)", "N(1, sd=2)"), 
		lwd=c(2,2), col=c("black","red"), bty="n")
		
		#Probability within 1 sd 
		#(1)P(-1 < X < 1) from the standard normal distribution
		pnorm(1) - pnorm(-1) 
		
		#(2)P(-2 < X < 2) from the N(0, sd=2) distribution
		pnorm(2, mean=0, sd=2) - pnorm(-2, mean=0, sd=2)
		
		#Quantile function
		#Find the x value such that the area under the curve for X > x is 0.025.
		qnorm(1-0.025)

		#Find the x value such that the area under the curve for X > x is 0.05.
		qnorm(1-0.05)
		
```

## Normally distributed variables

### Definition: Density curve

A density curve represents the distribution of a continuous random variable. It can also approximate the distribution of a discrete random variable.

-   A density curve is always on or above the horizontal axis. **Why?**
-   The total area under a density curve equals 1. **Why?**

![Density curve: Total area = 1](https://i.ibb.co/xMTS5Cs/263-Figure-06-01.png)

### Area under the curve within a range

The percentage of of ALL possible observations of a random variable that lie within a range equals the corresponding area under the curve in that range, and expressed as a percentage.

![Area under the curve within a range](https://i.ibb.co/28sc1Mq/264-Figure-06-02a.png)
![Area under the curve within a range](https://i.ibb.co/6YdByfy/264-Figure-06-02b.png)

![Area under the curve within a range](https://i.ibb.co/vmmCMF0/264-Figure-06-02c.png)

#### Example

Consider a density curve of a continuous random variable. Suppose the area under the density curve between 3 and 4 is 0.387, and the area under the curve to the right of 2 is 0.762. 

**Question:** What percentage of all possible observations of the variable are at most 2? What percentage of all possible observations are between 3 and 4?

**Solution:** 0.238 and 0.387.


#### Example

The crystals of a certain mineral are cubes. The length of the sides is a variable that has the density curve shown below. The equation of this density curve is 
$$
y = \frac{x}{2}
$$

for $0<x<2$ mm.


![Crystals](https://i.ibb.co/fH1L8TP/265-Figure-06-03a.png)

![Crystals](https://i.ibb.co/q05HW39/265-Figure-06-03b.png)

Determine the percentage of these crystals that have side lengths: (a) $<0.5mm$; (b) between 1 and 1.5 mm. (c) at least $0.25mm$. 

**Solution:**

The triangular area under the density curve from 0 to $x$ is $\frac{1}{2}(x)\frac{x}{2} = \frac{x^2}{4}$.

(a) The percentage of $<0.5mm$ is $\frac{0.5^2}{4}=0.0625$.

```{r}
area.under.density.curve(cdf = function(x){x^2/4}, interval = c(0, 0.5))

```

![Crystals](https://i.ibb.co/56xBNf6/265-Figure-06-04.png)
(b) between 1 and 1.5 mm.

The percentage is $\frac{1.5^2}{4}-\frac{1^2}{4}=0.3125$

```{r}
area.under.density.curve(cdf = function(x){x^2/4}, interval = c(1, 1.5))

```

![Crystals](https://i.ibb.co/Fnyk6Xv/265-Figure-06-05.png)

(c) The percentage is $\frac{2^2}{4}-\frac{0.25^2}{4}=0.984375$

```{r}
area.under.density.curve(cdf = function(x){x^2/4}, interval = c(0.25, 2))

#or calculate from the left
1 - area.under.density.curve(cdf = function(x){x^2/4}, interval = c(0,0.25))

```


![Crystals](https://i.ibb.co/hgLxGPc/265-Figure-06-06.png)

### Normally Distributed Variable

A variable is said to be a normally distributed variable or to have a normal distribution if its distribution has the shape of a normal curve.

![Normal](https://i.ibb.co/rcpZ9mn/266-Figure-06-07.png)

![Normal](https://i.ibb.co/t4xsfTm/266-Figure-06-08.png)


The normal density curve has mean parameter $\mu$ and standard deviation parameter $\sigma$ with the following form:

$$
f(x) = \frac{1}{\sqrt{2\pi\sigma}}e^{-\frac{1}{2}\cdot\frac{(x-\mu)^2}{\sigma^2}}
$$

The total area under the normal density curve is 1, i.e.,
$$
\int_{-\infty}^{\infty} f(x)dx = 1
$$

Please try out different $N(\mu, \sigma)$ distributions below.

```{r}
draw.normal.dist(mu=0, sigma=3, xlim=c(-30, 40), ylim=c(0,0.13))
draw.normal.dist(mu=0, sigma=5, xlim=c(-30, 40), ylim=c(0,0.13))
draw.normal.dist(mu=0, sigma=10, xlim=c(-30, 40), ylim=c(0,0.13))
draw.normal.dist(mu=10, sigma=3, xlim=c(-30, 40), ylim=c(0,0.13))
draw.normal.dist(mu=10, sigma=5, xlim=c(-30, 40), ylim=c(0,0.13))
draw.normal.dist(mu=10, sigma=10, xlim=c(-30, 40), ylim=c(0,0.13))
```

#### Example: Heights

Table below shows the relative frequencies of a college's 3264 female freshman students' heights. The mean is 64.4 inches and sd is 2.4 inches. 

```{r, echo=FALSE}
library(knitr)

heights <- data.frame(
  Height_in = c("56–under 57","57–under 58","58–under 59","59–under 60",
                "60–under 61","61–under 62","62–under 63","63–under 64",
                "64–under 65","65–under 66","66–under 67","67–under 68",
                "68–under 69","69–under 70","70–under 71","71–under 72",
                "72–under 73","73–under 74","Total"),
  Frequency_f = c(3, 6, 26, 74, 147, 247, 382, 483, 559, 514, 
                  359, 240, 122, 65, 24, 7, 5, 1, 3264),
  Relative_freq = c(0.0009,0.0018,0.0080,0.0227,0.0450,
                    0.0757,0.1170,0.1480,0.1713,0.1575,
                    0.1100,0.0735,0.0374,0.0199,0.0074,
                    0.0021,0.0015,0.0003,1.0000)
)

kable(heights, caption = "Height distribution with frequencies and relative frequencies")
```


(a) Show that the variable height is approximately normally distributed.

**Solution.**

Superimpose the normal density curve with mean 64.4 and sd 2.4 on top of the relative frequency. If they are consistent, then it indicates the variable height is approximately normal.

```{r}
#Data entry
height <- 56:73
freq <- c(3, 6, 26, 74, 147, 247, 382, 483, 559, 514, 359, 240, 122, 65, 24, 7, 5, 1)

n <- sum(freq)
n

rel.freq <- freq/n

rel.freq

data <- data.frame(cbind(height, freq, rel.freq))
data
```


Draw relative frequency plot and superimpose the normal curve. They are quite consistent.

```{r}
draw.normal.dist(mu=64.4, sigma=2.4)
lines(height, rel.freq, type="h", lwd=5, col="gray")
```


### Standard Normal Distribution

A normal distribution with mean 0 and standard deviation 1 is called standard normal distribution. 

For $x\sim N(\mu, \sigma)$, we can standardize x by transformation
$$
z = \frac{x-\mu}{\sigma}
$$
so $z$ follows a standard normal distribution.

![Standardization](https://i.ibb.co/cNGR7H6/269-Figure-06-12.png)

We can use the standardized normal distribution to calculate the area under the curve because of the relationship below.

![Standardization](https://i.ibb.co/nLbzRM0/270-Figure-06-13.png)

### Simulating a normally distributed variable

Consider gestation periods of humans are normally distributed with a mean of 266 days and sd of 16 days. Simulate 10000 human gestation periods, obtain a histogram of the simulated data.

```{r}
x <- rnorm(10000, mean=266, sd=16) #simulating 10000 normal data
hist(x, col="turquoise", main="Histogram of 10000 simulated gestation periods of humans", freq=FALSE, xlab="Gestation Periods (days)")

lines(density(x),col="red", lwd=3)
```

## Areas under the N(0, 1) density curve

### Basic properties of N(0, 1)

Let's have a closer look at the N(0, 1) curve.

```{r}
draw.normal.dist(mu=0, sigma=1)
```

-   **Property 1:** The total area under the standard normal curve is 1.
-   **Property 2:** The standard normal curve extends indefinitely in both directions, approaching, but never touching, the horizontal axis as it does so.
-   **Property 3:** The standard normal curve is symmetric about 0; that is, the part of the curve to the left of the dashed line in Fig. 8.14 is the mirror image of the part of the curve to the right of it.
-   **Property 4:** Almost all the area under the standard normal curve lies between −3 and 3.


### Example

Find the area under the standard normal density curve to the left of $z=1.23$.

```{r}
draw.shade.under.density(dfun = dnorm, range=c(-3.5, 3.5), 
 shade.interval=c(-3.5, 1.23), 
 curve.col = "aquamarine4", shade.col = "turquoise",
 xlab="z", ylab="Density Curve of N(0, 1)", mean=0, sd=1)
```
**Solution**

The area under the curve to the left of 1.23 is calculated as
$$
\int_{-\infty}^{1.23} f(x)dx = \Phi(1.23)
$$

where $\Phi()$ is the cumulative distribution function (CDF) of the standard normal. It can be calculated as $$\Phi(1.23)$$

```{r}
pnorm(1.23)
```
You can also calculate using the general function below.
```{r}

area.under.density.curve(cdf=pnorm, interval=c(-Inf, 1.23))
```

### Example

Find the area under the standard normal curve to the right of 0.76.

```{r}
draw.shade.under.density(dfun = dnorm, range=c(-3.5, 3.5), 
 shade.interval=c(0.76, 3.5), 
 curve.col = "aquamarine4", shade.col = "turquoise",
 xlab="z", ylab="Density Curve of N(0, 1)", mean=0, sd=1)
```

This area can be calculated as the 1 minus the area to the left $$1-\Phi(0.76)$$

```{r}
1-pnorm(0.76)
```

You can also calculate using the general function below.
```{r}
area.under.density.curve(cdf=pnorm, interval=c(0.76, Inf))
```

### Example

Find the area under the density curve of N(0, 1) between -0.68 and 1.82.


```{r}
draw.shade.under.density(dfun = dnorm, range=c(-3.5, 3.5), 
 shade.interval=c(-0.68, 1.82), 
 curve.col = "aquamarine4", shade.col = "turquoise",
 xlab="z", ylab="Density Curve of N(0, 1)", mean=0, sd=1)
```


This area can be calculated as $$\Phi(1.82)-\Phi(-0.68)$$

```{r}
pnorm(1.82)-pnorm(-0.68)
```

You can also calculate using the general function below.
```{r}
area.under.density.curve(cdf=pnorm, interval=c(-0.68, 1.82))
```


In summary.

![Area under the Curve](https://i.ibb.co/BtjhNxz/276-Figure-06-18.png)




### Example:Finding the z-score having a specified area to its left

What is the z-score having an area of 0.04 to its left under the standard normal distribution?

![Quantile](https://i.ibb.co/n7pdm7G/277-Figure-06-19.png)

The CDF ($\Phi(z)$) is to find out the area under the curve. In other words, $$\Phi(z)$$ means the area under the curve of N(0, 1) to the left of $z$. 

$$
\Phi(z) = P(Z < z)
$$

Given the area under the curve to the left of $z$, the z-score can be determined by inverse calculation. 

$$
p = \Phi(z) \\
z = \Phi^{-1}(p)
$$

The second function is called quantile function. It is calculated in R as `qnorm`. Given $p$, we can find $z$, and the $z$ is called the $p$th quantile.

```{r}
qnorm(0.04)
```

So the 4\% quantile is -1.75.

### Find the Quantile

Find the quantile such that the area to the right of the quantile is 0.025.

```{r}
qnorm(1-0.025)
```

Since the area to the right of the quantile is 0.025, then the area to its left is 1-0.025. So the quantile can be calculated as qnorm(0.975).

### Notations

Sometimes people use notation $z_{\alpha}$ to indicate the quantile of the area to its right is $\alpha$. However, this notation is not uniformly acceptable and can be confusing. Another notation is $z_{1-\alpha}$, which means the same quantile but more explicit and consistent with the quantile function $qnorm()$. To avoid confusions, I recommend using the notation of $z_{1-\alpha}$, which explicitly means the $(1-\alpha)\times 100\%$ percentile.


## Normally distributed variable

### Procedure to determine a probability of a $N(\mu, \sigma)$ variable

To Determine a Percentage or Probability for a Normally Distributed Variable
-   *Step 1* Sketch the normal curve associated with the variable.
-   *Step 2* Shade the region of interest and mark its delimiting x-value(s).
-   *Step 3* Find the z-score(s) for the delimiting x-value(s) found in Step 2.
-   *Step 4* Use Table II to find the area under the standard normal curve delimited by the z-score(s) found in Step 3.

![Procedure to determine a probability of a $N(\mu, \sigma)$ variable](https://i.ibb.co/tLXFJMR/normal-prob.png)


For $X \sim N(\mu, \sigma)$, the probability 
$$
P(a < X < b) = P \left(\frac{a-\mu}{\sigma} < Z < \frac{b-\mu}{\sigma}\right) = \Phi\left( \frac{b-\mu}{\sigma}\right) - \Phi\left(\frac{a-\mu}{\sigma}\right)
$$

### Example: IQ

IQ is normally distributed with a mean of 100 and standard deviation of 16. Determine the percentage of patients whose IQ between 115 and 140.

**solution.**

Let $X$ denote the IQ score. Then mean of $X$ is 100 and standard deviation is 16.

$$
P(115 < X < 140) = \Phi\left( \frac{140-100}{16}\right) - \Phi\left(\frac{115-100}{16}\right)=\Phi(2.5)-\Phi(0.94) = 0.168
$$

Once convert to $Phi$ function, we can calculate as

```{r}
pnorm((140-100)/16) - pnorm((115-100)/16)
```

You can also use the function

```{r}
area.under.density.curve(cdf=pnorm, interval = c(115, 140), mean=100, sd=16)
```


### Empirical Rule

![Empirical rule](https://i.ibb.co/hMWVFjg/119-Figure-03-09.png)


## Normal probability plot

### How do we check normality?

Given a sample, how do we know the sample is likely from normal distribution?

*    If the sample size is large, we can draw histogram, then superimpose the normal density curve with the sample mean and sample standard deviation. The normality is assessed by superimposing the density curve and check consistency.
*    If the sample size is small, we need more sensitive technique to check normality.


### Definition

Normal probability plot is a plot of the observed values of the variable versus the normal scores - the observations expected for a variable having standard normal distribution.

### Assessing normality

Guidelines for Assessing Normality Using a Normal Probability Plot

-   To assess the normality of a variable using sample data, construct a normal probability plot.
-   If the plot is roughly linear, you can assume that the variable is approximately normally distributed.
-   If the plot is not roughly linear, you can assume that the variable is not approximately normally distributed.
-   These guidelines should be interpreted loosely for small samples but usually interpreted strictly for large samples.

### Example: Gross Income

IRS publishes data for adjusted gross income ($1000s). 

```{r}
AGI <- c(9.7, 93.1, 33, 21.2, 
         81.4, 51.1, 43.5, 10.6, 
         12.8, 7.8, 18.1, 12.7)
```

Plot the normal probability plot. In R, the expected normal score is expected quantile if the sample is normally distributed. The normal score used in `qqnorm()` function is calculated by: 
-   first ordering the sample in increasing order, 
-   then the ith observation is corresponding to a normal score, calculated by

$$
z_i =\Phi^{-1}\left( \frac{i-a}{n+1-2a}\right)
$$

where $n$ is the sample size, and $a = 3/8$ for $n \le 10$, and $a=0.5$ for $n>10$. Note: This is slightly different from the textbook Table III.


```{r}
normal.prob.plot(AGI, col="turquoise", xlab="AGI", ylab="Expected Normal Score")
```


The normal probability plot is apparently not linear, so the AGI is not normally distributed.


You can also check normality by boxplot in a rough fashion.
```{r}
boxplot(AGI, col="turquoise")
```

### Use normal probability plot to detect outliers

Chicken consumption in pounds is shown below.

```{r}
y <- c(57, 69, 63, 49, 63, 61, 72, 65, 91, 59, 0, 82, 60, 75, 55, 80, 73)

normal.prob.plot(y, col="turquoise", xlab="Chicken Consumption (LB)", ylab="Expected Normal Score")
```

The observation 0 is detected as one outlier.










